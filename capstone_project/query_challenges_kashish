DROP DATABASE IF EXISTS sports_tracker;
CREATE DATABASE IF NOT EXISTS sports_tracker;
USE sports_tracker; 

DROP TABLE IF EXISTS sports;

CREATE TABLE IF NOT EXISTS sports(
    sport_id INT PRIMARY KEY,
    name VARCHAR (100),
    description TEXT,
    UNIQUE(name)
);

DROP TABLE IF EXISTS leagues;

CREATE TABLE IF NOT EXISTS leagues(
    league_id INT PRIMARY KEY,
    name VARCHAR (100),
    sport_id INT,
    description TEXT,
    FOREIGN KEY (sport_id) REFERENCES sports(sport_id),
    UNIQUE(name)
);

DROP TABLE IF EXISTS seasons;

CREATE TABLE IF NOT EXISTS seasons(
    season_id INT PRIMARY KEY,
    league_id INT,
    season_number INT UNSIGNED,
    FOREIGN KEY (league_id) REFERENCES leagues(league_id)
);
DROP TABLE IF EXISTS teams;

CREATE TABLE IF NOT EXISTS teams(
    team_id INT PRIMARY KEY,
    name VARCHAR(100),
    city VARCHAR (50),
    league_id INT,
    FOREIGN KEY (league_id) REFERENCES leagues(league_id),
    UNIQUE(name)
);

DROP TABLE IF EXISTS players;

CREATE TABLE IF NOT EXISTS players(
    player_id INT PRIMARY KEY,
    name VARCHAR(100),
    age INT,
    UNIQUE(name)
);

DROP TABLE IF EXISTS player_teams;

CREATE TABLE IF NOT EXISTS player_teams(
    player_id INT,
    team_id INT,
    start_date DATE,
    end_date DATE,
    position VARCHAR(50),
    FOREIGN KEY (player_id) REFERENCES players(player_id),
    FOREIGN KEY (team_id) REFERENCES teams(team_id),
    PRIMARY KEY(player_id, team_id)
);

DROP TABLE IF EXISTS locations;

CREATE TABLE IF NOT EXISTS locations(
    location_id INT PRIMARY KEY,
    name VARCHAR(250),
    city VARCHAR(100),
    UNIQUE(name)
);

DROP TABLE IF EXISTS matches;

CREATE TABLE IF NOT EXISTS matches(
    match_id INT PRIMARY KEY,
    season_id INT,
    match_date DATETIME,
    location_id INT,
    FOREIGN KEY (season_id) REFERENCES seasons(season_id),
    FOREIGN KEY (location_id) REFERENCES locations(location_id)
);

DROP TABLE IF EXISTS outcome_type;

CREATE TABLE IF NOT EXISTS outcome_type(
    outcome_type_id INT PRIMARY KEY,
    league_id INT,
    outcome_name VARCHAR(50),
    outcome_points INT,
    FOREIGN KEY (league_id) REFERENCES leagues(league_id)
);

DROP TABLE IF EXISTS match_teams;

CREATE TABLE IF NOT EXISTS match_teams(
    match_id INT,
    team_id INT,
    outcome_type_id INT,
    PRIMARY KEY(match_id, team_id),
    FOREIGN KEY (match_id) REFERENCES matches(match_id),
    FOREIGN KEY (team_id) REFERENCES teams(team_id),
    FOREIGN KEY (outcome_type_id) 
        REFERENCES outcome_type(outcome_type_id)
);

DROP TABLE IF EXISTS events;

CREATE TABLE IF NOT EXISTS events(
    event_id INT PRIMARY KEY,
    event_name VARCHAR(100),
    UNIQUE(event_name)
);

DROP TABLE IF EXISTS player_match_stats;

CREATE TABLE IF NOT EXISTS player_match_stats(
    player_match_stats_id INT PRIMARY KEY,
    player_id INT,
    match_id INT,
    time DATETIME,
    event_id INT,
    value DECIMAL(5,2),
    FOREIGN KEY (match_id) REFERENCES matches(match_id),
    FOREIGN KEY (player_id) REFERENCES players(player_id),
    FOREIGN KEY (event_id) REFERENCES events(event_id)
);
-- ############################
-- #  INSERT INTO STATEMENTS  #
-- ############################
INSERT INTO sports (sport_id, name, description)
VALUES
(1, 'Hockey', 'A team sport played on ice where players use sticks to 
    direct a puck into the opposing goal.'),
(2, 'Soccer', 'A team sport played on a field where players aim to score 
    goals by kicking a ball into the opponent’s net.'),
(3, 'Fortnite', 'A competitive video game league tracking team-based 
    matches and performance outcomes.'),
(4, 'Baseball', 'A bat-and-ball game played between two teams who take
     turns batting and fielding.'),
(5, 'Basketball', 'A team sport where two teams try to score points by
     throwing a ball through the opposing hoop.');


INSERT INTO leagues (league_id, name, sport_id, description)
VALUES
(1, 'NHL', 1, 'National Hockey League'),
(2, 'FIFA World League', 2, 'Global soccer competition under FIFA regulations'),
(3, 'Fortnite NA League', 3, 'North American regional Fortnite competition'),
(4, 'MLB', 4, 'Major League Baseball'),
(5, 'NBA', 5, 'National Basketball Association');


INSERT INTO seasons (season_id, league_id, season_number)
VALUES
(1, 1, 2024),
(2, 2, 2024),
(3, 3, 2024),
(4, 4, 2024),
(5, 5, 2024);


INSERT INTO teams (team_id, name, city, league_id)
VALUES
(1, 'Toronto Blades', 'Toronto', 1),
(2, 'Vancouver Wolves', 'Vancouver', 1),
(3, 'Madrid Eagles', 'Madrid', 2),
(4, 'Buenos Aires Lions', 'Buenos Aires', 2),
(5, 'Team Omega', 'New York', 3),
(6, 'Team Nova', 'Los Angeles', 3),
(7, 'Chicago Bats', 'Chicago', 4),
(8, 'New York Rockets', 'New York', 4),
(9, 'Chicago Bulls', 'Chicago', 5),
(10, 'Los Angeles Flames', 'Los Angeles', 5);


INSERT INTO players (player_id, name, age)
VALUES
(1, 'Wayne Gretzky', 63),       -- Hockey legend
(2, 'Sidney Crosby', 37),
(3, 'Lionel Messi', 37),        -- Soccer
(4, 'Cristiano Ronaldo', 40),
(5, 'Ninja', 33),               -- Fortnite player
(6, 'Tfue', 31),
(7, 'Babe Ruth', 129),          -- Baseball legend
(8, 'Shohei Ohtani', 30),
(9, 'Michael Jordan', 62),      -- Basketball + Baseball
(10, 'LeBron James', 40);


INSERT INTO player_teams 
    (player_id, team_id, start_date, end_date, position)
VALUES

(1, 1, '2023-01-01', NULL, 'Center'), -- Hockey players
(2, 2, '2022-09-01', NULL, 'Forward'),
(3, 3, '2023-02-15', NULL, 'Forward'), -- Soccer players
(4, 4, '2022-08-10', NULL, 'Striker'),
(5, 5, '2023-01-10', NULL, 'Shooter'), -- Fortnite players
(6, 6, '2023-01-10', NULL, 'Builder'),
(7, 7, '2022-04-01', '2024-03-30', 'Pitcher'), -- Baseball players
(8, 8, '2024-04-01', NULL, 'Designated Hitter'),
(9, 9, '2023-09-01', NULL, 'Shooting Guard'), -- Basketball players
(10, 10, '2022-10-01', NULL, 'Forward'),
(9, 7, '1994-01-01', '1995-12-31', 'Outfielder'); -- MJ also played baseball

INSERT INTO locations (location_id, name, city)
VALUES
(1, 'Toronto Ice Arena', 'Toronto'),
(2, 'Vancouver Skydome', 'Vancouver'),
(3, 'Madrid National Stadium', 'Madrid'),
(4, 'Buenos Aires Arena', 'Buenos Aires'),
(5, 'Fortnite Virtual Island', 'Online'),
(6, 'Chicago Ballpark', 'Chicago'),
(7, 'New York Grand Park', 'New York'),
(8, 'United Center', 'Chicago'),
(9, 'LA Sports Complex', 'Los Angeles');

INSERT INTO matches (match_id, season_id, match_date, location_id)
VALUES

(1, 1, '2024-03-15 19:00:00', 1), -- Hockey matches
(2, 1, '2024-04-20 19:00:00', 2),
(3, 2, '2024-05-10 20:00:00', 3), -- Soccer matches
(4, 2, '2024-06-02 18:00:00', 4),
(5, 3, '2024-07-01 17:00:00', 5), -- Fortnite matches
(6, 3, '2024-08-01 17:00:00', 5),
(7, 4, '2024-04-15 19:00:00', 6), -- Baseball matches
(8, 4, '2024-05-05 19:00:00', 7),
(9, 5, '2024-03-10 19:00:00', 8), -- Basketball matches
(10, 5, '2024-04-20 19:00:00', 9),
(11, 1, '2024-11-10 19:00:00', 1),
(12, 1, '2024-12-05 19:00:00', 2),
(13, 2, '2024-11-15 20:00:00', 3),
(14, 2, '2024-12-20 18:00:00', 4);


INSERT INTO outcome_type 
    (outcome_type_id, league_id, outcome_name, outcome_points)
VALUES
(1, 1, 'Win', 2), -- Hockey (Win = 2, OT Loss = 1, Loss = 0)
(2, 1, 'OT Loss', 1),
(3, 1, 'Loss', 0),
(4, 2, 'Win', 3), -- Soccer (Win = 3, Draw = 1, Loss = 0)
(5, 2, 'Draw', 1),
(6, 2, 'Loss', 0),
(7, 3, '1st', 15),-- Fortnite (Placement points 1st–11th)
(8, 3, '2nd', 12),
(9, 3, '3rd', 10),
(10, 3, '4th', 8),
(11, 3, '5th', 7),
(12, 3, '6th', 6),
(13, 3, '7th', 5),
(14, 3, '8th', 4),
(15, 3, '9th', 3),
(16, 3, '10th', 2),
(17, 3, '11th', 1),
(18, 3, '12th+', 0),
(19, 4, 'Win', 2), -- Baseball (Win/Loss)
(20, 4, 'Loss', 0),
(21, 5, 'Win', 2), -- Basketball (Win/Loss)
(22, 5, 'Loss', 0);


INSERT INTO match_teams (match_id, team_id, outcome_type_id)
VALUES
-- Hockey
(1, 1, 1),  -- Toronto Blades Win
(1, 2, 3),  -- Vancouver Wolves Loss
(2, 1, 2),  -- Toronto OT Loss
(2, 2, 1),  -- Vancouver Win
(3, 3, 4),  -- Madrid Eagles Win: -- Soccer
(3, 4, 6),  -- Buenos Aires Loss
(4, 3, 5),  -- Madrid Draw
(4, 4, 5),  -- Buenos Aires Draw
(5, 5, 7),  -- Omega 1st : -- Fortnite
(5, 6, 8),  -- Nova 2nd
(6, 5, 9),  -- Omega 3rd
(6, 6, 11), -- Nova 5th
(7, 7, 19), -- Chicago Bats Win : -- Baseball
(7, 8, 20), -- NY Rockets Loss
(8, 7, 20),
(8, 8, 19),
(9, 9, 21), -- Bulls Win : -- Basketball
(9, 10, 22),-- Flames Loss
(10, 9, 22),
(10, 10, 21),
(11, 1, 1),
(11, 2, 3),
(12, 2, 2),
(12, 1, 1),
(13, 3, 4),
(13, 4, 6),
(14, 3, 5),
(14, 4, 5);

INSERT INTO events (event_id, event_name)
VALUES
(1, 'Goal'),
(2, 'Assist'),
(3, 'Penalty'),
(4, 'Kill'),
(5, 'Accuracy'),
(6, 'TimeAlive'),
(7, 'HomeRun'),
(8, 'Strike'),
(9, 'Rebound'),
(10, '3Pointer'),
(11, 'FreeThrow');

INSERT INTO player_match_stats 
    (player_match_stats_id, player_id, match_id, event_id, value)
VALUES
-- Hockey (Gretzky & Crosby)
(1, 1, 1, 1, 1),     -- Gretzky Goal (1 goal)
(2, 1, 1, 2, 1),     -- Gretzky Assist (1 assist)
(3, 2, 1, 1, 1),     -- Crosby Goal
(4, 2, 2, 1, 1),     -- Crosby Goal
(5, 2, 2, 2, 1),     -- Crosby Assist
(6, 3, 3, 1, 1),     -- Messi Goal -- Soccer (Messi & Ronaldo)
(7, 3, 3, 2, 1),     -- Messi Assist
(8, 4, 4, 1, 1),     -- Ronaldo Goal
(9, 5, 5, 4, 5),     -- Ninja Kills (5 kills) -- Fortnite (Ninja & Tfue)
(10, 5, 5, 5, 89.50),-- Ninja Accuracy %
(11, 5, 5, 6, 97.80),-- Ninja Time Alive (min)
(12, 6, 5, 4, 3),    -- Tfue Kills (3 kills)
(13, 6, 5, 5, 92.10),-- Tfue Accuracy %
(14, 6, 5, 6, 100.50),-- Tfue Time Alive (min)
(15, 6, 6, 4, 7),    -- Tfue Kills
(16, 6, 6, 5, 88.00),-- Tfue Accuracy
(17, 6, 6, 6, 95.70),-- Tfue Time Alive
(18, 7, 7, 7, 1),    -- Babe Ruth HomeRun -- Baseball (Babe Ruth, Ohtani, Jordan)
(19, 8, 8, 7, 1),    -- Ohtani HomeRun
(20, 9, 7, 8, 1),    -- Jordan Strike (baseball era)
(21, 9, 9, 10, 2),   -- Jordan 3-pointers (2) -- Basketball
(22, 9, 9, 11, 5),   -- Jordan Free throws (5)
(23, 10, 9, 9, 10),  -- LeBron Rebounds
(24, 10, 10, 10, 3), -- LeBron 3-pointers
(25, 10, 10, 11, 4),
(26, 1, 11, 1, 1),  -- Gretzky Goal
(27, 2, 11, 2, 1),  -- Crosby Assist
(28, 2, 12, 1, 1),  -- Crosby Goal
(29, 3, 13, 1, 1),  -- Messi Goal
(30, 4, 13, 2, 1),  -- Ronaldo Assist
(31, 3, 14, 1, 1),  -- Messi Goal
(32, 4, 14, 1, 1); -- LeBron Free throws

SELECT p.name, COUNT(pm.event_id)
FROM players p 
JOIN player_match_stats pm 
ON p.player_id = pm.player_id
JOIN matches m
ON m.match_id = pm.match_id
WHERE event_id = (
    SELECT event_id FROM events
    WHERE event_name = "Goal" OR "Assist"
)
GROUP BY p.name
HAVING m.match_date > "2024-11-06 00:00:00"
LIMIT 5;